<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Test Chat Simple</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    .message { margin: 10px 0; padding: 10px; border-radius: 5px; }
    .user { background: #e3f2fd; text-align: right; }
    .assistant { background: #f5f5f5; }
    input { width: 80%; padding: 10px; }
    button { padding: 10px 20px; }
    .debug { background: #fff3cd; padding: 10px; margin: 10px 0; }
  </style>
</head>
<body>

<div id="app">
  <h1>Test Chat Simple</h1>
  
  <div class="debug">
    <strong>Debug Info:</strong><br>
    Total mensajes: {{ messages.length }}<br>
    Loading: {{ loading }}<br>
    Error: {{ error || 'ninguno' }}
  </div>
  
  <div>
    <input 
      v-model="messageInput" 
      @keyup.enter="sendMessage"
      placeholder="Escribe un mensaje..."
    >
    <button @click="sendMessage" :disabled="loading">Enviar</button>
  </div>
  
  <div v-if="loading" style="color: blue; margin: 10px 0;">
    ‚è≥ Cargando...
  </div>
  
  <div style="margin-top: 20px;">
    <div v-for="(msg, index) in messages" :key="index" :class="['message', msg.role]">
      <strong>{{ msg.role }}:</strong> {{ msg.content }}
    </div>
  </div>
</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      messages: [],
      messageInput: '',
      loading: false,
      error: null,
      authToken: 'test-token',
      AI_GATEWAY_URL: 'http://localhost:5000'
    };
  },
  
  methods: {
    async sendMessage() {
      const message = this.messageInput.trim();
      if (!message || this.loading) return;
      
      console.log('üì§ Enviando:', message);
      
      // Agregar mensaje del usuario
      this.messages.push({
        role: 'user',
        content: message
      });
      
      this.messageInput = '';
      this.loading = true;
      this.error = null;
      
      try {
        console.log('üì° Llamando a API...');
        
        const response = await axios.post(
          `${this.AI_GATEWAY_URL}/chat/message`,
          { message },
          {
            headers: {
              'Authorization': `Bearer ${this.authToken}`,
              'Content-Type': 'application/json'
            }
          }
        );
        
        console.log('‚úÖ Respuesta:', response.data);
        
        // Agregar respuesta
        this.messages.push({
          role: 'assistant',
          content: response.data.response || 'Sin respuesta'
        });
        
        console.log('üìã Total mensajes:', this.messages.length);
        
      } catch (err) {
        console.error('‚ùå Error:', err);
        this.error = err.message;
        
        this.messages.push({
          role: 'assistant',
          content: '‚ùå Error: ' + (err.response?.data?.error || err.message)
        });
      } finally {
        this.loading = false;
      }
    }
  }
}).mount('#app');
</script>

</body>
</html>
