<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SaluMedX - Sistema de GestiÃ³n</title>
  
  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  
  <!-- Axios para peticiones HTTP -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  
  <!-- CSS externo -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="app" :class="{ dark: isDark }">
  <!-- LOGIN VIEW -->
  <div v-if="currentView === 'login'" class="card">
    <h1>ğŸ¥ SaluMedX</h1>
    <h2>Iniciar SesiÃ³n</h2>

    <!-- ConfiguraciÃ³n de API URL + Ping -->
    <div class="alert alert-info" style="margin-top:10px;">
      <div style="display:flex; gap:10px; align-items:center; flex-wrap: wrap;">
        <label style="margin:0;">API URL:</label>
        <input v-model="API_URL" style="flex:1; min-width:280px;" placeholder="https://salumedx-rest.onrender.com">
        <button type="button" class="btn btn-secondary" @click="saveApiUrl" :disabled="loading">
          Guardar
        </button>
        <button type="button" class="btn btn-secondary" @click="pingApi" :disabled="loading">
          Probar conexiÃ³n
        </button>
      </div>
    </div>
    
    <div v-if="error" class="alert alert-error">{{ error }}</div>
    <div v-if="success" class="alert alert-success">{{ success }}</div>
    
    <form @submit.prevent="handleLogin">
      <div class="form-group">
        <label for="username">Usuario:</label>
        <input 
          type="text" 
          id="username" 
          v-model="loginForm.username" 
          placeholder="Ingrese su usuario"
          required
        >
      </div>
      
      <div class="form-group">
        <label for="password">ContraseÃ±a:</label>
        <input 
          type="password" 
          id="password" 
          v-model="loginForm.password" 
          placeholder="Ingrese su contraseÃ±a"
          required
        >
      </div>
      
      <button type="submit" class="btn btn-primary" :disabled="loading">
        <span v-if="loading" class="loading"></span>
        <span v-else>Iniciar SesiÃ³n</span>
      </button>
    </form>
    
    <p class="link" @click="currentView = 'register'">
      Â¿No tienes cuenta? RegÃ­strate aquÃ­
    </p>
  </div>

  <!-- REGISTER VIEW -->
  <div v-if="currentView === 'register'" class="card">
    <h1>ğŸ¥ SaluMedX</h1>
    <h2>Crear Cuenta</h2>

    <!-- ConfiguraciÃ³n de API URL + Ping -->
    <div class="alert alert-info" style="margin-top:10px;">
      <div style="display:flex; gap:10px; align-items:center; flex-wrap: wrap;">
        <label style="margin:0;">API URL:</label>
        <input v-model="API_URL" style="flex:1; min-width:280px;" placeholder="https://salumedx-rest.onrender.com">
        <button type="button" class="btn btn-secondary" @click="saveApiUrl" :disabled="loading">
          Guardar
        </button>
        <button type="button" class="btn btn-secondary" @click="pingApi" :disabled="loading">
          Probar conexiÃ³n
        </button>
      </div>
    </div>
    <div v-if="error" class="alert alert-error">{{ error }}</div>
    <div v-if="success" class="alert alert-success">{{ success }}</div>
    
    <form @submit.prevent="handleRegister">
      <div class="form-group">
        <label for="reg-username">Usuario:</label>
        <input 
          type="text" 
          id="reg-username" 
          v-model="registerForm.username" 
          placeholder="Elija un nombre de usuario"
          required
        >
      </div>
      
      <div class="form-group">
        <label for="reg-email">Email:</label>
        <input 
          type="email" 
          id="reg-email" 
          v-model="registerForm.email" 
          placeholder="correo@ejemplo.com"
          required
        >
      </div>
      
      <div class="form-group">
        <label for="reg-password">ContraseÃ±a:</label>
        <input 
          type="password" 
          id="reg-password" 
          v-model="registerForm.password" 
          placeholder="MÃ­nimo 8 caracteres"
          required
        >
      </div>
      
      <div class="form-group">
        <label for="reg-password2">Confirmar ContraseÃ±a:</label>
        <input 
          type="password" 
          id="reg-password2" 
          v-model="registerForm.password2" 
          placeholder="Repita la contraseÃ±a"
          required
        >
      </div>

      <div class="form-group">
        <label for="reg-role">Tipo de Usuario:</label>
        <select 
          id="reg-role" 
          v-model="registerForm.role" 
          required
          style="padding: 10px; border: 1px solid var(--border); border-radius: 4px; font-size: 1em; background: var(--input-bg); color: var(--text); width: 100%; box-sizing: border-box; cursor: pointer;"
        >
          <option value="">-- Selecciona un rol --</option>
          <option value="paciente">ğŸ‘¤ Paciente</option>
          <option value="medico">ğŸ©º MÃ©dico</option>
          <option value="farmacista">ğŸ’Š Farmacista</option>
          <option value="admin">ğŸ‘‘ Administrador</option>
        </select>
      </div>
      
      <button type="submit" class="btn btn-primary" :disabled="loading">
        <span v-if="loading" class="loading"></span>
        <span v-else>Registrarse</span>
      </button>
    </form>
    
    <p class="link" @click="currentView = 'login'">
      Â¿Ya tienes cuenta? Inicia sesiÃ³n aquÃ­
    </p>
  </div>

  <!-- PANEL VIEW -->
  <div v-if="currentView === 'panel'" class="layout" role="main" aria-label="Panel principal">
    <aside class="sidebar" aria-label="NavegaciÃ³n principal">
      <h3>NAVEGACIÃ“N</h3>
      <a href="#" class="nav-link" :class="{active: activeTab==='recetas'}" @click.prevent="activeTab='recetas'">ğŸ“‹ Recetas</a>
      <a href="#" class="nav-link" :class="{active: activeTab==='pdf'}" @click.prevent="activeTab='pdf'">ğŸ“„ Generar PDF</a>
      <a href="#" class="nav-link" :class="{active: activeTab==='precios'}" @click.prevent="activeTab='precios'">ğŸ’° Precios</a>
      <a href="#" class="nav-link" :class="{active: activeTab==='pacientes'}" @click.prevent="activeTab='pacientes'">ğŸ‘¥ Pacientes</a>
      <a href="#" v-if="isAdmin()" class="nav-link" :class="{active: activeTab==='admin'}" @click.prevent="activeTab='admin'">ğŸ› ï¸ Admin</a>
      <hr style="margin:14px 0; border-color: var(--border);">
      <a href="#" @click.prevent="openChat" class="nav-link" style="background: linear-gradient(135deg, #a78bfa 0%, #06b6d4 100%); color: white; text-align: center; margin-bottom: 8px; transition: all 0.3s ease;" 
         onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(167, 139, 250, 0.4)'"
         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
        <i class="bi bi-robot"></i> ğŸ¤– Asistente IA (Pilar 3)
      </a>
      <a href="http://localhost:4000/dashboard" v-if="isAdmin()" class="nav-link" target="_blank" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; margin-bottom: 8px; transition: all 0.3s ease;" 
         onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(102, 126, 234, 0.4)'"
         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
        <i class="bi bi-speedometer2"></i> ğŸ“Š Dashboard Notificaciones
      </a>
      <button class="btn btn-secondary btn-theme-toggle" style="width:100%; margin-bottom:8px;" @click="toggleDark" :aria-pressed="isDark">
        <span v-if="isDark">â˜€ï¸ Modo Claro</span>
        <span v-else>ğŸŒ™ Modo Oscuro</span>
      </button>
      <button class="btn btn-secondary" style="width:100%;" @click="toggleDebug" :aria-pressed="debugMode">{{ debugMode ? 'ğŸ”’ Ocultar Debug' : 'ğŸ”“ Mostrar Debug' }}</button>
    </aside>
    <div class="card">
      <h1>ğŸ¥ SaluMedX</h1>
      <div class="breadcrumbs">Inicio / {{ activeTab }}</div>
      <div class="user-info">
        <div style="display: flex; flex-direction: column; gap: 4px;">
          <span>ğŸ‘¤ Usuario: {{ username }}</span>
          <span v-if="userRole || username" :style="{ color: (userRole === 'admin' || (username && username.toLowerCase && username.toLowerCase() === 'admin')) ? 'var(--success)' : (isMedico ? 'var(--success)' : 'var(--info)'), fontWeight: '500', fontSize: '0.9em' }">
            {{ (userRole === 'admin' || (username && username.toLowerCase && username.toLowerCase() === 'admin')) ? 'ğŸ‘‘ Administrador' : (isMedico ? 'ğŸ©º MÃ©dico' : 'ğŸ§‘â€âš•ï¸ Paciente') }}
          </span>
        </div>
        <div>
          <button @click="testAuth" class="btn btn-secondary" style="margin-right: 10px;" :disabled="loading">ğŸ” Probar Auth</button>
          <button @click="handleLogout" class="btn btn-danger">Cerrar SesiÃ³n</button>
        </div>
      </div>
      <div v-if="error" class="alert alert-error" role="alert">{{ error }}</div>
      <div v-if="success" class="alert alert-success" role="status">{{ success }}</div>
      <div v-if="debugMode" class="alert alert-info" style="margin: 15px 0; padding: 12px;">
        <strong>ğŸ” Debug Auth:</strong><br>
        <small>
          <strong>Token:</strong> {{ authToken ? authToken.substring(0, 25) + '...' : 'SIN TOKEN' }}<br>
          <strong>API:</strong> {{ API_URL }}<br>
          <strong>GraphQL:</strong> {{ GRAPHQL_URL }}
        </small>
      </div>

      <!-- TAB: RECETAS -->
      <div v-if="activeTab === 'recetas'">
        <h2>Mis Recetas</h2>
        <button @click="obtenerRecetas" class="btn btn-primary" :disabled="loading">
          <span v-if="loading" class="loading"></span>
          <span v-else>Cargar Recetas</span>
        </button>
        <div v-if="respuesta" class="response-box" aria-live="polite">
          <pre>{{ JSON.stringify(respuesta, null, 2) }}</pre>
        </div>
      </div>

      <!-- TAB: PDF -->
      <div v-if="activeTab === 'pdf'">
        <h2>Generar Receta PDF</h2>
        
        <div v-if="!isMedico" class="alert-error" style="margin-bottom: 20px; display: flex; align-items: start; gap: 10px;">
          <span style="font-size: 24px;">ğŸš«</span>
          <div>
            <strong>Acceso Restringido - Usuario: PACIENTE</strong><br>
            <small>Tu cuenta estÃ¡ registrada como <strong>paciente</strong>. Solo los usuarios con perfil de <strong>mÃ©dico</strong> pueden generar recetas mÃ©dicas. 
            Si necesitas una receta, contacta a tu mÃ©dico tratante.</small>
          </div>
        </div>
        
        <div v-else class="alert-success" style="margin-bottom: 20px; display: flex; align-items: start; gap: 10px;">
          <span style="font-size: 24px;">âœ…</span>
          <div>
            <strong>Acceso Autorizado - Usuario: MÃ‰DICO</strong><br>
            <small>Tienes permisos para generar recetas mÃ©dicas. Completa los datos del paciente y mÃ©dico para crear el PDF.</small>
          </div>
        </div>

        <div class="form-group">
          <label>Nombre del Paciente:</label>
          <input v-model="pdfForm.paciente.nombre" placeholder="Ej: Cesar" :disabled="!isMedico">
        </div>
        <div class="form-group">
          <label>CÃ©dula del Paciente:</label>
          <input v-model="pdfForm.paciente.cedula" placeholder="Ej: 1122334455" :disabled="!isMedico">
        </div>
        <div class="form-group">
          <label>Nombre del MÃ©dico:</label>
          <input v-model="pdfForm.medico.nombre" placeholder="Ej: Abigail" :disabled="!isMedico">
        </div>
        <div class="form-group">
          <label>Licencia del MÃ©dico:</label>
          <input v-model="pdfForm.medico.licencia" placeholder="Ej: 987654321" :disabled="!isMedico">
        </div>
        <button @click="generarPDF" class="btn btn-success" :disabled="loading || !isMedico">
          <span v-if="loading" class="loading"></span>
          <span v-else-if="!isMedico">ğŸš« Acceso Restringido</span>
          <span v-else>âœ… Generar PDF</span>
        </button>
        <div v-if="respuesta" class="response-box" aria-live="polite">
          <pre>{{ JSON.stringify(respuesta, null, 2) }}</pre>
        </div>
      </div>

      <!-- TAB: PRECIOS -->
      <div v-if="activeTab === 'precios'">
        <h2>Consultar Precios</h2>
        <div class="form-group">
          <label>Nombre del Medicamento:</label>
          <input v-model="preciosForm.nombre" placeholder="Ej: Paracetamol">
        </div>
        <div class="form-group">
          <label>Latitud:</label>
          <input v-model.number="preciosForm.lat" type="number" step="0.000001" placeholder="Ej: -0.21">
        </div>
        <div class="form-group">
          <label>Longitud:</label>
          <input v-model.number="preciosForm.lng" type="number" step="0.000001" placeholder="Ej: -78.49">
        </div>
        <div class="form-group">
          <label>Radio (Km):</label>
          <input v-model.number="preciosForm.radioKm" type="number" placeholder="Ej: 5">
        </div>
        <button @click="consultarPrecios" class="btn btn-primary" :disabled="loading">
          <span v-if="loading" class="loading"></span>
          <span v-else>Buscar Precios</span>
        </button>
        <div v-if="respuesta" class="response-box" aria-live="polite">
          <pre>{{ JSON.stringify(respuesta, null, 2) }}</pre>
        </div>
      </div>

      <!-- TAB: PACIENTES -->
      <div v-if="activeTab === 'pacientes'">
        <h2>Pacientes Registrados</h2>
        <button @click="obtenerPacientes" class="btn btn-primary" :disabled="loading">
          <span v-if="loading" class="loading"></span>
          <span v-else>Cargar Pacientes</span>
        </button>
        <div v-if="respuesta && respuesta.pacientes" style="margin-top: 20px;">
          <div style="background: var(--input-bg); border: 1px solid var(--border); border-radius: 8px; padding: 20px;">
            <h3 style="margin-bottom: 15px; color: var(--text);">Total: {{ respuesta.pacientes.length }} paciente(s)</h3>
            <div v-for="paciente in respuesta.pacientes" :key="paciente.id" 
                 style="background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 15px; margin-bottom: 10px;">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px;">
                <div><strong style="color: var(--muted);">ID:</strong> <span style="color: var(--text);">{{ paciente.id }}</span></div>
                <div><strong style="color: var(--muted);">Nombre:</strong> <span style="color: var(--text);">{{ paciente.nombre || 'N/A' }}</span></div>
                <div><strong style="color: var(--muted);">CÃ©dula:</strong> <span style="color: var(--text);">{{ paciente.cedula || 'N/A' }}</span></div>
                <div><strong style="color: var(--muted);">Email:</strong> <span style="color: var(--text);">{{ paciente.email || 'N/A' }}</span></div>
              </div>
            </div>
          </div>
        </div>
        <div v-else-if="respuesta" class="response-box" aria-live="polite">
          <pre>{{ JSON.stringify(respuesta, null, 2) }}</pre>
        </div>
      </div>

      <!-- TAB: ADMIN -->
      <div v-if="activeTab === 'admin'">
        <h2>Panel de AdministraciÃ³n (API)</h2>
        <div class="alert alert-info" style="margin-bottom:12px;">
          <strong>Consumo de endpoints administrativos:</strong>
          <br>
          <small>api/admin/productos/ &nbsp; api/admin/farmacias/ &nbsp; api/admin/producto-farmacia/</small>
        </div>

        <div v-if="isAdmin()" style="margin-bottom:12px;">
          <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:10px;">
            <button class="btn btn-success" @click="showFormProducto = !showFormProducto">
              <span v-if="showFormProducto">ğŸ”½ Ocultar</span>
              <span v-else>â• Crear Producto</span>
            </button>
            <button class="btn btn-success" @click="showFormFarmacia = !showFormFarmacia">
              <span v-if="showFormFarmacia">ğŸ”½ Ocultar</span>
              <span v-else>â• Crear Farmacia</span>
            </button>
            <button class="btn btn-success" @click="showFormRelacion = !showFormRelacion">
              <span v-if="showFormRelacion">ğŸ”½ Ocultar</span>
              <span v-else>â• Crear Precio</span>
            </button>
          </div>
        </div>

        <!-- FORMULARIO PRODUCTO -->
        <div v-if="showFormProducto" style="background: #e8f5e9; border: 2px solid #28a745; padding: 20px; margin: 15px 0; border-radius: 8px; display: block !important;">
          <h3>ğŸ“ Agregar Nuevo Producto</h3>
          <div style="display: grid; gap: 10px;">
            <div>
              <label>Nombre Comercial:</label>
              <input v-model="adminNewProduct.nombre_comercial" type="text" placeholder="Ej: Paracetamol 500mg" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label>Nombre GenÃ©rico:</label>
              <input v-model="adminNewProduct.nombre_generico" type="text" placeholder="Ej: AcetaminofÃ©n" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label>Principio Activo:</label>
              <input v-model="adminNewProduct.principio_activo" type="text" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label>CategorÃ­a:</label>
              <input v-model="adminNewProduct.categoria" type="text" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label>PresentaciÃ³n:</label>
              <input v-model="adminNewProduct.presentacion" type="text" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label>ConcentraciÃ³n:</label>
              <input v-model="adminNewProduct.concentracion" type="text" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label>Precio:</label>
              <input v-model.number="adminNewProduct.precio" type="number" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label>DescripciÃ³n:</label>
              <textarea v-model="adminNewProduct.descripcion" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; height: 80px;"></textarea>
            </div>
            <button @click="addAdminProducto" style="background: #007bff; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
              âœ… GUARDAR PRODUCTO
            </button>
          </div>
        </div>

        <!-- FORMULARIO FARMACIA -->
        <div v-if="showFormFarmacia" style="background: #e8f5e9; border: 2px solid #28a745; padding: 20px; margin: 15px 0; border-radius: 8px; display: block !important;">
          <h3>ğŸ¥ Agregar Nueva Farmacia</h3>
          <div style="display: grid; gap: 10px;">
            <div>
              <label>Nombre de Farmacia:</label>
              <input v-model="adminNewFarmacia.nombre" type="text" placeholder="Ej: Farmacia del Centro" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label>Horario de AtenciÃ³n:</label>
              <input v-model="adminNewFarmacia.horario" type="text" placeholder="Ej: 8:00 AM - 10:00 PM" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label>DirecciÃ³n:</label>
              <input v-model="adminNewFarmacia.direccion" type="text" placeholder="Calle Principal 123" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label>TelÃ©fono:</label>
              <input v-model="adminNewFarmacia.telefono" type="text" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label>Latitud:</label>
              <input v-model.number="adminNewFarmacia.lat" type="number" step="0.000001" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label>Longitud:</label>
              <input v-model.number="adminNewFarmacia.lng" type="number" step="0.000001" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <button @click="addAdminFarmacia" style="background: #007bff; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
              âœ… GUARDAR FARMACIA
            </button>
          </div>
        </div>

        <!-- FORMULARIO RELACIÃ“N -->
        <div v-if="showFormRelacion" style="background: #e8f5e9; border: 2px solid #28a745; padding: 20px; margin: 15px 0; border-radius: 8px; display: block !important;">
          <h3>ğŸ’° Agregar Precio por Farmacia</h3>
          <div style="display: grid; gap: 10px;">
            <div>
              <label>Producto ID:</label>
              <input v-model.number="adminNewRelacion.producto" type="number" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label>Farmacia ID:</label>
              <input v-model.number="adminNewRelacion.farmacia" type="number" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div>
              <label>Precio: <span style="color: red;">*</span></label>
              <input v-model.number="adminNewRelacion.precio" type="number" step="0.01" placeholder="Ej: 15.50" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <button @click="addAdminRelacion" style="background: #007bff; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
              âœ… GUARDAR RELACIÃ“N
            </button>
          </div>
        </div>

        <div class="panel-actions" style="margin-bottom:12px;">
          <div>
            <button class="btn btn-primary" @click="fetchAdminProductos" :disabled="adminLoadingProductos">
              <span v-if="adminLoadingProductos" class="loading"></span>
              <span v-else>ğŸ“¦ Cargar Productos</span>
            </button>
            <button class="btn btn-secondary" @click="clearAdminProductos" style="margin-left:8px;">Limpiar</button>
          </div>

          <div>
            <button class="btn btn-primary" @click="fetchAdminFarmacias" :disabled="adminLoadingFarmacias">
              <span v-if="adminLoadingFarmacias" class="loading"></span>
              <span v-else>ğŸ¥ Cargar Farmacias</span>
            </button>
            <button class="btn btn-secondary" @click="clearAdminFarmacias" style="margin-left:8px;">Limpiar</button>
          </div>

          <div>
            <button class="btn btn-primary" @click="fetchAdminProductoFarmacia" :disabled="adminLoadingRelacion">
              <span v-if="adminLoadingRelacion" class="loading"></span>
              <span v-else>ğŸ”— Cargar Producto-Farmacia</span>
            </button>
            <button class="btn btn-secondary" @click="clearAdminRelacion" style="margin-left:8px;">Limpiar</button>
          </div>
        </div>

        <div v-if="adminError" class="alert alert-error">{{ adminError }}</div>

        <!-- TABLA: PRODUCTOS -->
        <div v-if="adminData.productos && adminData.productos.length > 0" style="margin-top: 40px; margin-bottom: 30px;">
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
            <span style="font-size: 24px;">ğŸ“¦</span>
            <div>
              <h2 style="margin: 0; font-size: 22px; font-weight: 700; color: var(--text);">Productos</h2>
              <p style="margin: 4px 0 0 0; color: var(--muted); font-size: 14px;">{{ adminData.productos.length }} producto(s) cargado(s)</p>
            </div>
          </div>
          
          <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
              <thead>
                <tr style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white;">
                  <th v-for="key in Object.keys(adminData.productos[0] || {})" :key="key"
                      style="padding: 14px 16px; text-align: left; font-weight: 700; text-transform: capitalize;">
                    {{ key.replace(/_/g, ' ') }}
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="(producto, index) in adminData.productos" :key="index" 
                    :style="{ background: index % 2 === 0 ? 'transparent' : 'rgba(40, 167, 69, 0.04)', borderBottom: '1px solid var(--border)' }"
                    @mouseenter="$event.target.style.background = 'rgba(40, 167, 69, 0.08)'" 
                    @mouseleave="$event.target.style.background = index % 2 === 0 ? 'transparent' : 'rgba(40, 167, 69, 0.04)'">
                  <td v-for="(value, key) in producto" :key="key" style="padding: 12px 16px; color: var(--text);">
                    <span v-if="key === 'id' || key.includes('_id')" 
                          style="background: rgba(40, 167, 69, 0.1); color: #28a745; padding: 4px 8px; border-radius: 4px; font-weight: 600;">
                      {{ value || 'N/A' }}
                    </span>
                    <span v-else-if="key === 'precio' || key.includes('precio')" 
                          style="color: #28a745; font-weight: 700;">
                      ${{ value || '0.00' }}
                    </span>
                    <span v-else>
                      {{ value || 'N/A' }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- TABLA: FARMACIAS -->
        <div v-if="adminData.farmacias && adminData.farmacias.length > 0" style="margin-top: 40px; margin-bottom: 30px;">
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
            <span style="font-size: 24px;">ğŸ¥</span>
            <div>
              <h2 style="margin: 0; font-size: 22px; font-weight: 700; color: var(--text);">Farmacias</h2>
              <p style="margin: 4px 0 0 0; color: var(--muted); font-size: 14px;">{{ adminData.farmacias.length }} farmacia(s) cargada(s)</p>
            </div>
          </div>
          
          <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
              <thead>
                <tr style="background: linear-gradient(135deg, #6c63ff 0%, #667eea 100%); color: white;">
                  <th v-for="key in Object.keys(adminData.farmacias[0] || {})" :key="key"
                      style="padding: 14px 16px; text-align: left; font-weight: 700; text-transform: capitalize;">
                    {{ key.replace(/_/g, ' ') }}
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="(farmacia, index) in adminData.farmacias" :key="index"
                    :style="{ background: index % 2 === 0 ? 'transparent' : 'rgba(102, 126, 234, 0.04)', borderBottom: '1px solid var(--border)' }"
                    @mouseenter="$event.target.style.background = 'rgba(102, 126, 234, 0.08)'" 
                    @mouseleave="$event.target.style.background = index % 2 === 0 ? 'transparent' : 'rgba(102, 126, 234, 0.04)'">
                  <td v-for="(value, key) in farmacia" :key="key" style="padding: 12px 16px; color: var(--text);">
                    <span v-if="key === 'id' || key.includes('_id')" 
                          style="background: rgba(102, 126, 234, 0.1); color: #667eea; padding: 4px 8px; border-radius: 4px; font-weight: 600;">
                      {{ value || 'N/A' }}
                    </span>
                    <span v-else-if="typeof value === 'number' && (key.includes('lat') || key.includes('lng'))"
                          style="font-family: monospace; font-size: 12px;">
                      {{ value.toFixed(4) || 'N/A' }}
                    </span>
                    <span v-else>
                      {{ value || 'N/A' }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- TABLA: RELACIONES PRODUCTO-FARMACIA -->
        <div v-if="adminData.productoFarmacia && adminData.productoFarmacia.length > 0" style="margin-top: 40px; margin-bottom: 30px;">
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
            <span style="font-size: 24px;">ğŸ”—</span>
            <div>
              <h2 style="margin: 0; font-size: 22px; font-weight: 700; color: var(--text);">Relaciones Producto-Farmacia</h2>
              <p style="margin: 4px 0 0 0; color: var(--muted); font-size: 14px;">{{ adminData.productoFarmacia.length }} relaciÃ³n(es) cargada(s)</p>
            </div>
          </div>
          
          <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
              <thead>
                <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                  <th v-for="key in Object.keys(adminData.productoFarmacia[0] || {})" :key="key"
                      style="padding: 14px 16px; text-align: left; font-weight: 700; text-transform: capitalize;">
                    {{ key.replace(/_/g, ' ') }}
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="(relacion, index) in adminData.productoFarmacia" :key="index" 
                    :style="{ background: index % 2 === 0 ? 'transparent' : 'rgba(102, 126, 234, 0.04)', borderBottom: '1px solid var(--border)' }"
                    @mouseenter="$event.target.style.background = 'rgba(102, 126, 234, 0.08)'" 
                    @mouseleave="$event.target.style.background = index % 2 === 0 ? 'transparent' : 'rgba(102, 126, 234, 0.04)'">
                  <td v-for="(value, key) in relacion" :key="key" style="padding: 12px 16px; color: var(--text);">
                    <span v-if="key === 'id'" 
                          style="background: rgba(102, 126, 234, 0.1); color: #667eea; padding: 4px 8px; border-radius: 4px; font-weight: 600;">
                      {{ value || 'N/A' }}
                    </span>
                    <span v-else-if="key === 'producto' || key.includes('producto')" 
                          style="background: rgba(40, 167, 69, 0.1); color: #28a745; padding: 4px 8px; border-radius: 4px; font-weight: 600;">
                      {{ value || 'N/A' }}
                    </span>
                    <span v-else-if="key === 'farmacia' || key.includes('farmacia')" 
                          style="background: rgba(102, 126, 234, 0.1); color: #667eea; padding: 4px 8px; border-radius: 4px; font-weight: 600;">
                      {{ value || 'N/A' }}
                    </span>
                    <span v-else-if="key === 'precio' || key.includes('precio')" 
                          style="color: #28a745; font-weight: 700;">
                      ${{ value || '0.00' }}
                    </span>
                    <span v-else-if="key === 'stock' || key.includes('stock')" 
                          style="background: rgba(108, 99, 255, 0.1); color: #667eea; padding: 4px 8px; border-radius: 4px; font-weight: 600;">
                      {{ value || '0' }}
                    </span>
                    <span v-else>
                      {{ value || 'N/A' }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<div class="overlay" :class="{ show: loading }" aria-live="assertive" aria-busy="true">
  <div class="spinner" role="progressbar" aria-label="Cargando"></div>
</div>

<!-- JavaScript externo -->
<script src="app.js"></script>

</body>
</html>