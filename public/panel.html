<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel SaluuMedX</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
<div id="app">
  <h1>Panel SaluuMedX</h1>

  <button @click="obtenerRecetas">Ver Mis Recetas</button>
  <button @click="generarPDF">Crear Receta en PDF</button>
  <button @click="consultarPrecios">Precios M√°s Baratos</button>

  <pre>{{ respuesta }}</pre>
</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return { respuesta: {} };
  },

  methods: {
    async graphql(query, variables = {}) {
      const res = await fetch("http://localhost:4000/graphql", {
        method: "POST",
        credentials: "include",  // üî• ENV√çA sessionid + csrftoken !!
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query, variables })
      });

      return res.json();
    },

    async obtenerRecetas() {
      const q = `
        query {
          recetas {
            idReceta
            fechaEmision
            diagnostico
            detalles { cantidad dosis }
          }
        }
      `;

      this.respuesta = await this.graphql(q);
    },

    async generarPDF() {
      const q = `
        mutation($pac: PacienteInput!, $med: MedicoInput!) {
          generarRecetaPdf(paciente: $pac, medico: $med) {
            mensaje
            archivo
          }
        }
      `;

      const vars = {
        pac: { nombre: "Cesar", cedula: "1122334455" },
        med: { nombre: "Abigail", licencia: "987654321" }
      };

      this.respuesta = await this.graphql(q, vars);
    },

    async consultarPrecios() {
      const q = `
        query {
          preciosMasBaratos(nombre:"Paracetamol", lat:-0.21, lng:-78.49, radioKm:5) {
            farmaciaNombre
            precio
            distanciaKm
          }
        }
      `;

      this.respuesta = await this.graphql(q);
    }
  }
}).mount("#app");
</script>

</body>
</html>
